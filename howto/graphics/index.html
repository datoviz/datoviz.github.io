
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="High-performance interactive scientific data visualization library">
      
      
      
        <meta name="author" content="Cyrille Rossant">
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.7">
    
    
      
        <title>How to write a custom graphics - Datoviz Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.39b8e14a.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-to-write-a-custom-graphics" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="Datoviz Documentation" class="md-header-nav__button md-logo" aria-label="Datoviz Documentation">
      
  <img src="../../images/logow.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Datoviz Documentation
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              How to write a custom graphics
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/datoviz/datoviz/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../tutorials/" class="md-tabs__link">
        Tutorials
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../examples/" class="md-tabs__link">
        Examples
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../" class="md-tabs__link md-tabs__link--active">
        How to guides
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../reference/" class="md-tabs__link">
        Reference
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../api/" class="md-tabs__link">
        C API reference
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../discussions/" class="md-tabs__link">
        Discussions
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Datoviz Documentation" class="md-nav__button md-logo" aria-label="Datoviz Documentation">
      
  <img src="../../images/logow.png" alt="logo">

    </a>
    Datoviz Documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/datoviz/datoviz/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" data-md-state="indeterminate" type="checkbox" id="nav-2" checked>
      
      <label class="md-nav__link" for="nav-2">
        Tutorials
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="nav-2">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/" class="md-nav__link">
        Index
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/install/" class="md-nav__link">
        Installation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/quickstart/" class="md-nav__link">
        Quickstart
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" data-md-state="indeterminate" type="checkbox" id="nav-3" checked>
      
      <label class="md-nav__link" for="nav-3">
        Examples
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="nav-3">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/quickstart/" class="md-nav__link">
        Simple test with Python
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/signals/" class="md-nav__link">
        Digital signals
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/image/" class="md-nav__link">
        Image
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/france/" class="md-nav__link">
        France departements
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/raster/" class="md-nav__link">
        Raster plot
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/molecule/" class="md-nav__link">
        Molecule 3D mesh
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/brain/" class="md-nav__link">
        3D brain mesh
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/brain_highres/" class="md-nav__link">
        3D high-res brain mesh
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/twopanels/" class="md-nav__link">
        Two panels
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
      
      <label class="md-nav__link" for="nav-4">
        How to guides
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="How to guides" data-md-level="1">
        <label class="md-nav__title" for="nav-4">
          <span class="md-nav__icon md-icon"></span>
          How to guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Index
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../standalone_scene/" class="md-nav__link">
        How to write a standalone C app
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../visual/" class="md-nav__link">
        How to write a custom visual
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          How to write a custom graphics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        How to write a custom graphics
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#choosing-the-graphics-primitive-type" class="md-nav__link">
    Choosing the graphics primitive type
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-the-vertex-data-structure" class="md-nav__link">
    Defining the vertex data structure
  </a>
  
    <nav class="md-nav" aria-label="Defining the vertex data structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attribute-format" class="md-nav__link">
    Attribute format
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-the-vertex-shader" class="md-nav__link">
    Writing the vertex shader
  </a>
  
    <nav class="md-nav" aria-label="Writing the vertex shader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-shader-resources" class="md-nav__link">
    Common shader resources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#varying-variables" class="md-nav__link">
    Varying variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#position-transformation" class="md-nav__link">
    Position transformation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#special-glsl-variables" class="md-nav__link">
    Special GLSL variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#colormaps" class="md-nav__link">
    Colormaps
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-the-fragment-shader" class="md-nav__link">
    Writing the fragment shader
  </a>
  
    <nav class="md-nav" aria-label="Writing the fragment shader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clipping" class="md-nav__link">
    Clipping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#special-variables" class="md-nav__link">
    Special variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compiling-the-shaders-to-spir-v" class="md-nav__link">
    Compiling the shaders to SPIR-V
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-the-custom-graphics" class="md-nav__link">
    Writing the custom graphics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-the-custom-visual" class="md-nav__link">
    Writing the custom visual
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-a-simple-test" class="md-nav__link">
    Writing a simple test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-topics" class="md-nav__link">
    Other topics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#checklist-for-datoviz-contributors" class="md-nav__link">
    Checklist for Datoviz contributors
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../standalone_canvas/" class="md-nav__link">
        How to use the canvas C API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../standalone_vklite/" class="md-nav__link">
        How to use the vklite C API
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" data-md-state="indeterminate" type="checkbox" id="nav-5" checked>
      
      <label class="md-nav__link" for="nav-5">
        Reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="nav-5">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/" class="md-nav__link">
        Index
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/visuals/" class="md-nav__link">
        List of visuals
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/graphics/" class="md-nav__link">
        List of graphics
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/colormaps/" class="md-nav__link">
        List of colormaps
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/controllers/" class="md-nav__link">
        List of controllers
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" data-md-state="indeterminate" type="checkbox" id="nav-6" checked>
      
      <label class="md-nav__link" for="nav-6">
        C API reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="C API reference" data-md-level="1">
        <label class="md-nav__title" for="nav-6">
          <span class="md-nav__icon md-icon"></span>
          C API reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../api/" class="md-nav__link">
        Index
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../api/scene/" class="md-nav__link">
        Scene API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../api/visual/" class="md-nav__link">
        Visual API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../api/controller/" class="md-nav__link">
        Controller API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../api/gui/" class="md-nav__link">
        GUI API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../api/canvas/" class="md-nav__link">
        Canvas API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../api/gpu/" class="md-nav__link">
        GPU API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../api/vklite/" class="md-nav__link">
        vklite API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../api/misc/" class="md-nav__link">
        Misc API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../api/enums/" class="md-nav__link">
        Enumerations
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" data-md-state="indeterminate" type="checkbox" id="nav-7" checked>
      
      <label class="md-nav__link" for="nav-7">
        Discussions
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Discussions" data-md-level="1">
        <label class="md-nav__title" for="nav-7">
          <span class="md-nav__icon md-icon"></span>
          Discussions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../discussions/" class="md-nav__link">
        Index
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../discussions/vulkan/" class="md-nav__link">
        Vulkan crash course
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../discussions/practices/" class="md-nav__link">
        Best practices
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../discussions/architecture/" class="md-nav__link">
        Library architecture
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../discussions/roadmap/" class="md-nav__link">
        Roadmap
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../discussions/developer/" class="md-nav__link">
        Developer notes
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../discussions/faq/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/datoviz/datoviz/edit/master/docs/howto/graphics.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="how-to-write-a-custom-graphics">How to write a custom graphics<a class="headerlink" href="#how-to-write-a-custom-graphics" title="Permanent link">&para;</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You need to go through the <a href="../../discussions/vulkan/"><strong>Vulkan crash course</strong></a> before following this guide.
You also need to go through the <a href="../visual/"><strong>how to write a custom visual guide</strong></a> first.</p>
</div>
<p>In this section, we'll show how to <strong>create a custom graphics</strong> by writing <strong>custom GLSL shaders</strong>. This is an advanced topic as it requires understanding the basic of GPU graphics programming.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only the C API supports custom graphics at the moment. Python bindings for custom graphics will come in an upcoming version. Datoviz already includes the code necessary to compile GLSL shaders to SPIR-V on the fly (based on <a href="https://github.com/KhronosGroup/glslang/">Khronos glslang</a>).</p>
</div>
<p>The full source code for this example can be found in <code>examples/custom_graphics.c</code>.</p>
<p>As a toy example, we'll create <strong>a graphics with square points of various size and color</strong>. Specifically, we'll require each point to have a different size (which is not supported in the existing <code>point</code> graphics), and a color depending directly on the size and computed directly on the GPU. We'll use a single byte per vertex to store the vertex size (between 0 and 255 pixels), and we'll use no memory for the color since it will be determined directly by this value. This kind of memory optimization is one of the use-cases of writing custom graphics. Limiting memory usage is important when dealing with extremely large datasets (tens or hundreds of millions of points).</p>
<p><img alt="An example of the custom graphics created here" src="../../images/screenshots/custom_graphics.png" /></p>
<p>Writing a custom graphics involves the following steps:</p>
<ol>
<li>Choosing the primitive type.</li>
<li>Defining the vertex data structure and corresponding vertex shader attributes.</li>
<li>Writing the vertex shader.</li>
<li>Writing the fragment shader.</li>
<li>Compiling the GLSL shaders to SPIR-V (may be done automatically in the future).</li>
<li>Writing the custom graphics.</li>
<li>Writing the custom visual.</li>
<li>Writing a simple test.</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Here, we show how to create a custom graphics compatible with the scene API, so that it can be used added to the scene the same way as builtin visuals. One could however decide <em>not to use</em> the scene API at all, and leverage instead the vklite API directly. This allows one to create entirely custom and standalone applications. This is not documented at the moment, and one should look at the vklite unit tests to understand how to use the vklite API directly.</p>
</div>
<h2 id="choosing-the-graphics-primitive-type">Choosing the graphics primitive type<a class="headerlink" href="#choosing-the-graphics-primitive-type" title="Permanent link">&para;</a></h2>
<p>Vulkan supports six major types of primitives:</p>
<ul>
<li><strong>point list</strong>: square points with an arbitrary size,</li>
<li><strong>line list</strong>: disjoint aliased line segments,</li>
<li><strong>line strip</strong>: joined aliased line segments,</li>
<li><strong>triangle strip</strong>: joined triangles consecutively sharing an edge,</li>
<li><strong>triangle fan</strong>: joined triangles all sharing a single corner (the first vertex),</li>
<li><strong>triangle list</strong>: disjoint triangles,</li>
</ul>
<p>Other less common primitive types are described in the <a href="https://www.khronos.org/registry/vulkan/specs/1.2-extensions/man/html/VkPrimitiveTopology.html">Vulkan specification</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Triangle fans are not supported on macOS.</p>
</div>
<p><img alt="Vulkan primitive types" src="../../images/primitive_types.png" />
<em>Schematic from the <a href="https://www.oreilly.com/library/view/vulkan-cookbook/9781786468154/f2ec181c-fca0-4121-aa67-c2cfd337a126.xhtml">Vulkan Cookbook by Pawel Lapinski, O'Reilly</a></em></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The circular arrows in the triangles above indicate the orientation of the triangles, which is taken into account by the GPU. It is good practice to always ensure that all triangles constituting a given object are consistent. For example, when triangulating a square with two triangles, the order of the vertices should be chosen such that both triangles are directly oriented. The graphics pipeline can be configured to handle triangle orientation in a specific way. For example, one can make a graphics pipeline where indirectly oriented triangles are automatically discarded.</p>
</div>
<p>Line primitives typically have a width of 1 pixel, although some hardware supports thicker lines. In Datoviz, thick, high-quality lines are implemented with triangles instead (line triangulation), and the antialiased thick line is drawn directly in the fragment shader. "Basic" line primitives are only used for testing and for special high-performance applications where scalability and performance are more important than visual quality.</p>
<p>The most commonly-used primitive types in scientific visualization are essentially <strong>point lists</strong> and <strong>triangle lists</strong> (and to a lesser extent, triangle strips).</p>
<p>In this example, we'll use a <strong>point list</strong>, where each point will correspond to one square.</p>
<h2 id="defining-the-vertex-data-structure">Defining the vertex data structure<a class="headerlink" href="#defining-the-vertex-data-structure" title="Permanent link">&para;</a></h2>
<p>Once we know we'll use a point list as a primitive, the next step is to define the vertex data structure / vertex shader attributes. Here, we want the following attributes for each vertex:</p>
<ul>
<li><strong>the point position</strong> (center of the square), as a <code>vec3</code>,</li>
<li><strong>the point size</strong> (edge length of the square, in pixels), as an <code>uint8_t</code>. The point size will be limited to a maximum of 255 pixels in this toy example.</li>
</ul>
<p>We could have simply used a floating-point for the edge length, but that would have used four bytes instead of one. This is also to show the versatility of Vulkan and GPU programming, where we have full control on the data types used on both the GPU and CPU.</p>
<p>Here is our vertex C structure:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// We define the vertex structure for our graphics pipeline.</span>
<span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
    <span class="n">vec3</span> <span class="n">pos</span><span class="p">;</span>     <span class="c1">// 3D point position</span>
    <span class="kt">uint8_t</span> <span class="n">size</span><span class="p">;</span> <span class="c1">// point size, in pixels, between 0 and 255.</span>
<span class="p">}</span> <span class="n">PointVertex</span><span class="p">;</span>
</code></pre></div>
<p>We also need to define the attributes in GLSL:</p>
<div class="highlight"><pre><span></span><code><span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mo">0</span><span class="p">)</span> <span class="k">in</span> <span class="kt">vec3</span> <span class="n">pos</span><span class="p">;</span>   <span class="c1">// x, y, z positions</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">in</span> <span class="kt">float</span> <span class="n">size</span><span class="p">;</span> <span class="c1">// point size, between 0.0 and 255.0</span>
</code></pre></div>
<h3 id="attribute-format">Attribute format<a class="headerlink" href="#attribute-format" title="Permanent link">&para;</a></h3>
<p>In this example, we use a <code>uint8_t</code> (byte) on the CPU, but a <code>float</code> on the GPU. Vulkan provides a way to specify the way we want to do the <strong>casting</strong>. This is done when creating the graphics pipeline below. We can just say here that we'll use the Vulkan format <code>VK_FORMAT_R8_USCALED</code>. This format means that:</p>
<ul>
<li><strong>Number of components</strong>. There is a single component (scalar), the <code>R</code> in <code>R8</code> means "red" component: this is the component used for scalar values. If using a pair of components, we would have both a <code>R</code> and <code>G</code> component (green). This naming convention using color names comes from the fact that these GPU formats are typically used to represent colors, but they can actually represent any type of numerical data.</li>
<li><strong>Number of bits per component</strong>. The 8 in <code>R8</code> means that our red component is represented with 8 bits.</li>
<li><strong>Signedness</strong>. The <code>U</code> in <code>USCALED</code> means that we use an unsigned format.</li>
<li><strong>Scaling</strong>. The <code>SCALED</code> means that the byte, a number between 0 and 255, will be converted to a float without normalization: 255 becomes 255.0.</li>
</ul>
<p>Here are the other common scaling options provided by Vulkan when using bytes:</p>
<table>
<thead>
<tr>
<th>Scaling</th>
<th>GPU number type</th>
<th>Range</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>UNORM</code></td>
<td><code>float</code></td>
<td><code>[0.0, 1.0]</code></td>
</tr>
<tr>
<td><code>SNORM</code></td>
<td><code>float</code></td>
<td><code>[-1.0, 1.0]</code></td>
</tr>
<tr>
<td><code>USCALED</code></td>
<td><code>float</code></td>
<td><code>[0.0, 255.0]</code></td>
</tr>
<tr>
<td><code>SSCALED</code></td>
<td><code>float</code></td>
<td><code>[-128.0, +127.0]</code> (?)</td>
</tr>
<tr>
<td><code>UINT</code></td>
<td><code>int</code></td>
<td><code>[0, 255]</code></td>
</tr>
<tr>
<td><code>SINT</code></td>
<td><code>int</code></td>
<td><code>[-128, 127]</code> (?)</td>
</tr>
</tbody>
</table>
<p>You'll find more information here:</p>
<ul>
<li><a href="https://www.khronos.org/registry/vulkan/specs/1.2-extensions/man/html/VkFormat.html">Full list of formats in the Vulkan spec</a>,</li>
<li><a href="http://vulkan.gpuinfo.org/listformats.php">Hardware support of the formats</a>: some formats are not supported by all existing GPUs. This website is quite useful to know what formats have the best hardware support.</li>
</ul>
<h2 id="writing-the-vertex-shader">Writing the vertex shader<a class="headerlink" href="#writing-the-vertex-shader" title="Permanent link">&para;</a></h2>
<p>We're now ready to write the vertex shader. Here is the full source code of the vertex shader:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// code from `examples/custom_point.vert`:</span>

<span class="c1">// GLSL version</span>
<span class="cp">#version 450</span>

<span class="c1">// To be compatible with the scene API, all graphics shaders must include a common GLSL include</span>
<span class="c1">// file. It defines common uniform bindings and common functions (for example, transform()).</span>
<span class="c1">// These .glsl files are found in `include/datoviz/glsl`, so one needs to pass</span>
<span class="c1">// `-Ipath/to/datoviz/include/datoviz/glsl` to the `glslc` command (see build.sh script).</span>
<span class="cp">#include &quot;common.glsl&quot;</span>

<span class="c1">// Here, we also use GLSL colormaps to compute the square color directly in the vertex shader,</span>
<span class="c1">// without using the colormap texture.</span>
<span class="cp">#include &quot;colormaps.glsl&quot;</span>

<span class="c1">// Here, we describe the vertex shader attributes.</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mo">0</span><span class="p">)</span> <span class="k">in</span> <span class="kt">vec3</span> <span class="n">pos</span><span class="p">;</span>   <span class="c1">// x, y, z positions</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">in</span> <span class="kt">float</span> <span class="n">size</span><span class="p">;</span> <span class="c1">// point size, between 0.0 and 255.0</span>

<span class="c1">// We made the unusual choice here to use a float in the shader, which corresponds to a uint8 byte</span>
<span class="c1">// in C. We also decided not to normalize it, i.e. that the byte 255 corresponds to the float 255.0</span>
<span class="c1">// in the shader (VK_FORMAT_R8_USCALED format). Other choices can be made when specifying the</span>
<span class="c1">// attribute format in the custom graphics definition.</span>

<span class="c1">// Here, we describe the &quot;varying&quot; variables. These are special values output by the vertex shader,</span>
<span class="c1">// and passed to the fragment shader.</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mo">0</span><span class="p">)</span> <span class="k">out</span> <span class="kt">vec4</span> <span class="n">out_color</span><span class="p">;</span>

<span class="c1">// Main shader code.</span>
<span class="kt">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Here, &quot;pos&quot; is the position of the vertex being processed. gl_Position is a special output</span>
    <span class="c1">// variable that returns the vertex final position in normalized device coordinates. It</span>
    <span class="c1">// is a vec4 vector, the fourth component is the homogeneous coordinate.</span>
    <span class="c1">// The &quot;transform()&quot; function is defined in common.glsl. It applies the model, view, proj</span>
    <span class="c1">// matrices stored in the first (common) uniform buffer (MVP buffer).</span>
    <span class="nb">gl_Position</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span>

    <span class="c1">// This special variable is an output variable that contains the point size, in pixels,</span>
    <span class="c1">// of the vertex being processed. It is reserved to graphics pipelines with a point list</span>
    <span class="c1">// primitive.</span>
    <span class="nb">gl_PointSize</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>

    <span class="c1">// Here, we set the varying variable that will be passed to the fragment shader.</span>
    <span class="c1">// The function colormap() is implemented in colormaps.glsl. It supports a few colormaps</span>
    <span class="c1">// that are implemented directly in GLSL, without using a texture. The second argument</span>
    <span class="c1">// is a value between 0 and 1, hence the normalization with the size which is in pixels.</span>
    <span class="n">out_color</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">(</span><span class="n">DVZ_CMAP_HSV</span><span class="p">,</span> <span class="n">size</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">);</span>
    <span class="n">out_color</span><span class="p">.</span><span class="n">a</span> <span class="o">=</span> <span class="mf">.25</span><span class="p">;</span> <span class="c1">// alpha component for some transparency</span>
<span class="p">}</span>
</code></pre></div>
<p>A few comments can be found below.</p>
<h3 id="common-shader-resources">Common shader resources<a class="headerlink" href="#common-shader-resources" title="Permanent link">&para;</a></h3>
<p>The <code>#include</code> directive is provided for convenience by the GLSL to SPIR-V compiler <code>glslc</code>. It is used extensively in Datoviz. It provides a simple way of making all graphics shaders share some functions and resources. In particular, we make the convention that, in order to be compatible with the scene API, <strong>all graphics pipelines in Datoviz must have the following common slots</strong>:</p>
<div class="highlight"><pre><span></span><code>layout (std140, binding = 0) uniform MVP {...};
layout (std140, binding = 1) uniform Viewport {...};
</code></pre></div>
<table>
<thead>
<tr>
<th>Binding</th>
<th>Descriptor type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>uniform</td>
<td>structure with the model-view-proj matrices</td>
</tr>
<tr>
<td>1</td>
<td>uniform</td>
<td>structure with viewport information</td>
</tr>
</tbody>
</table>
<p>This is done just by including <code>common.glsl</code> in every shader. Note that this is not required when using completely standalone graphics pipelines that will never be used with the scene API.</p>
<p>When one needs to add another bindings, the numbering should start at <code>USER_BINDING</code>, a special GLSL macro that is currently 2.</p>
<h4>Uniform alignment</h4>
<p>The <code>std140</code> keyword refers to the alignment of the fields within the uniform structure. We're not going into the details, but we'll present some relatively arbitrary rules that we follow in Datoviz so that we don't need to think too much about memory alignment considerations when working with uniform structures:</p>
<ul>
<li><strong>always use the <code>std140</code> keyword</strong> when defining uniform resources in the shaders,</li>
<li><strong>NEVER use the following data types in a uniform structure</strong>: <code>vec3</code>, <code>ivec3</code>, <code>mat3</code>, and any format with a 3 in it. If you need a vector with three components, use a <code>vec4</code> and leave the last component alone. This only affects uniforms, NOT attributes.</li>
</ul>
<h3 id="varying-variables">Varying variables<a class="headerlink" href="#varying-variables" title="Permanent link">&para;</a></h3>
<p>The vertex shader may pass some variables to the next stage, typically the fragment shader, using <strong>varying variables</strong>.</p>
<p>A crucial difference between the vertex and fragment shaders is that <strong>the vertex shader executes on every vertex</strong>, whereas <strong>the fragment shader executes on every pixel</strong>. When the vertex shader passes a value to the fragment shader, the GPU makes a <strong>linear interpolation</strong> for all pixels between two vertices in the same primitive. This is specific to line and triangle primitives, not points.</p>
<p>For example, passing 0 to one vertex and 1 to the next vertex in a graphics with a line primitive would result in all pixels being passed a real value between 0 and 1 depending on the position of that pixel within that line segment. This system is used in particular with:</p>
<ul>
<li>Color gradients,</li>
<li>Texture coordinates.</li>
</ul>
<h3 id="position-transformation">Position transformation<a class="headerlink" href="#position-transformation" title="Permanent link">&para;</a></h3>
<p>The <code>common.glsl</code> file defines (several overloaded versions of) the function <code>transform()</code>, which applies the model-view-proj matrices stored in the first bound resource, the <code>MVP</code> uniform. The associated C structure is <code>DvzMVP</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span> <span class="n">DvzMVP</span>
<span class="p">{</span>
    <span class="n">mat4</span> <span class="n">model</span><span class="p">;</span> <span class="c1">// model 4x4 matrix</span>
    <span class="n">mat4</span> <span class="n">view</span><span class="p">;</span>  <span class="c1">// view 4x4 matrix</span>
    <span class="n">mat4</span> <span class="n">proj</span><span class="p">;</span>  <span class="c1">// projection 4x4 matrix</span>
    <span class="kt">float</span> <span class="n">time</span><span class="p">;</span> <span class="c1">// elapsed time since the start of the application, in seconds</span>
<span class="p">};</span>
</code></pre></div>
<p>The transformation is basically <code>gl_Position = to_vulkan(proj * view * model * position)</code>.</p>
<p>The <code>to_vulkan()</code> internal function transforms the position from the OpenGL/Datoviz 3D coordinate system (y up, z toward the user) to the Vulkan coordinate system (y down, z toward the inside of the screen).</p>
<h3 id="special-glsl-variables">Special GLSL variables<a class="headerlink" href="#special-glsl-variables" title="Permanent link">&para;</a></h3>
<p>We use a few special GLSL variables in the vertex shader:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>gl_Position</code></td>
<td><code>vec4</code></td>
<td>final vertex position in normalized device coordinates</td>
</tr>
<tr>
<td><code>gl_PointSize</code></td>
<td><code>float</code></td>
<td>size of the point, when using the point list primitive</td>
</tr>
</tbody>
</table>
<p>There are many more special variables available in each type of shader. <a href="https://www.khronos.org/opengl/wiki/Built-in_Variable_(GLSL)">You'll find the list of special GLSL variables here.</a></p>
<h3 id="colormaps">Colormaps<a class="headerlink" href="#colormaps" title="Permanent link">&para;</a></h3>
<p>The <code>colormap()</code> function is implemented in <code>colormaps.glsl</code>. It provides a GLSL implementation of a few common colormaps, which allows to compute the color as a function of a scalar value <em>without using a texture</em>. There are a few advantages to this, mostly related to performance and avoiding edge effects when using nearest interpolation in the texture.</p>
<h2 id="writing-the-fragment-shader">Writing the fragment shader<a class="headerlink" href="#writing-the-fragment-shader" title="Permanent link">&para;</a></h2>
<p>We now pass to the fragment shader. Here is the code:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// code from `examples/custom_point.frag`:</span>

<span class="cp">#version 450</span>
<span class="cp">#include &quot;common.glsl&quot;</span>

<span class="c1">// The &quot;in&quot; variables here MUST correspond to the &quot;out&quot; variables from the vertex shader.</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mo">0</span><span class="p">)</span> <span class="k">in</span> <span class="kt">vec4</span> <span class="n">in_color</span><span class="p">;</span>

<span class="c1">// The first output variable of the fragment shader must be a vec4 variable with the RGBA</span>
<span class="c1">// components of the pixel being processed.</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mo">0</span><span class="p">)</span> <span class="k">out</span> <span class="kt">vec4</span> <span class="n">out_color</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// This macro is used to implement clipping in the inner viewport, when using panel margins.</span>
    <span class="c1">// All fragment shader of all graphics must include this macro for now.</span>
    <span class="n">CLIP</span>

    <span class="c1">// Here, we simply pass the varying color (already computed by the vertex shader) to the</span>
    <span class="c1">// output variable.</span>

    <span class="c1">// NOTE: we could also have passed the point size from the vertex shader to the fragment</span>
    <span class="c1">// shader, and compute the colormap here. HOWEVER the computation of the colormap would have</span>
    <span class="c1">// been done for each *pixel*, rather than each *vertex*. Since we&#39;re using uniform square</span>
    <span class="c1">// colors in this example, that would have resulted in wasted duplicate computations and</span>
    <span class="c1">// unjustified loss of performance.</span>
    <span class="c1">// When the pixel color is non uniform across the primitive, and not just linearly interpolated</span>
    <span class="c1">// between the vertices, one can compute the pixel color directly in the fragment shader.</span>
    <span class="n">out_color</span> <span class="o">=</span> <span class="n">in_color</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Here are a few comments.</p>
<h3 id="clipping">Clipping<a class="headerlink" href="#clipping" title="Permanent link">&para;</a></h3>
<p>Datoviz panels may have margins around them. We make the distinction between:</p>
<table>
<thead>
<tr>
<th>Viewport</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>inner viewport</td>
<td>area of the panel <em>excluding</em> the margins</td>
</tr>
<tr>
<td>outer viewport</td>
<td>area of the panel <em>including</em> the margins</td>
</tr>
</tbody>
</table>
<p>We follow the convention that <strong>the normalized coordinates <code>[-1, +1]</code> correspond to the inner viewport</strong>. Vertices beyond these limits will be rendered in the margins.</p>
<p>Clipping allows to hide all pixels outside the inner viewport. This is how we implement the axes controller: graphics should not be rendered in the margins which contain the tick labels. Any graphics that should be compatible with the axes controller should therefore have the special <code>CLIP</code> macro at the beginning of the fragments shader (implemented in <code>common.glsl</code>). This macro detects whether the current pixel is beyond the inner viewport, and if the graphics has been configured so, it discards that pixel.</p>
<h3 id="special-variables">Special variables<a class="headerlink" href="#special-variables" title="Permanent link">&para;</a></h3>
<p>We haven't used any special variable in this fragment shader, but here are two useful variables that we could use:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>gl_FragCoord</code></td>
<td><code>vec4</code></td>
<td>pixel position in window space</td>
</tr>
<tr>
<td><code>gl_PointCoord</code></td>
<td><code>vec2</code></td>
<td>coordinates of the pixel within the point primitive</td>
</tr>
</tbody>
</table>
<p>The <code>gl_PointCoord</code> variable is reserved to graphics pipelines using a point primitive. It provides the coordinates, in pixels, of the current pixel within the square. The origin is at the upper-left corner of the square.</p>
<h2 id="compiling-the-shaders-to-spir-v">Compiling the shaders to SPIR-V<a class="headerlink" href="#compiling-the-shaders-to-spir-v" title="Permanent link">&para;</a></h2>
<p>Once the shaders have been written, they should be compiled to SPIR-V (unless using Datoviz to compile shaders provided as GLSL code, but this is a work in progress). Here is how to compile the shaders on the command-line:</p>
<div class="highlight"><pre><span></span><code>glslc custom_point.vert -o custom_point.vert.spv
glslc custom_point.frag -o custom_point.frag.spv
</code></pre></div>
<p>The <code>glslc</code> command is provided by the Vulkan SDK.</p>
<h2 id="writing-the-custom-graphics">Writing the custom graphics<a class="headerlink" href="#writing-the-custom-graphics" title="Permanent link">&para;</a></h2>
<p>Here is the code to create a custom graphics compatible with the scene API, and to add it to a custom visual:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// We create a blank graphics that will become our custom graphics.</span>
<span class="n">DvzGraphics</span><span class="o">*</span> <span class="n">graphics</span> <span class="o">=</span> <span class="n">dvz_blank_graphics</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="c1">// Custom graphics creation.</span>

<span class="c1">// The first step is to define the vertex and fragment shaders. When using</span>
<span class="c1">// dvz_graphics_shader(), one must specify a path to the compiled SPIR-V shaders.</span>
<span class="c1">// When writing the shaders in GLSL, it is thus necessary to compile them separately with</span>
<span class="c1">// glslc.</span>
<span class="n">dvz_graphics_shader</span><span class="p">(</span><span class="n">graphics</span><span class="p">,</span> <span class="n">VK_SHADER_STAGE_VERTEX_BIT</span><span class="p">,</span> <span class="s">&quot;custom_point.vert.spv&quot;</span><span class="p">);</span>
<span class="n">dvz_graphics_shader</span><span class="p">(</span><span class="n">graphics</span><span class="p">,</span> <span class="n">VK_SHADER_STAGE_FRAGMENT_BIT</span><span class="p">,</span> <span class="s">&quot;custom_point.frag.spv&quot;</span><span class="p">);</span>

<span class="c1">// We define the graphics pipeline topology: point list here.</span>
<span class="n">dvz_graphics_topology</span><span class="p">(</span><span class="n">graphics</span><span class="p">,</span> <span class="n">VK_PRIMITIVE_TOPOLOGY_POINT_LIST</span><span class="p">);</span>

<span class="c1">// Next, we declare the size of our vertex structure.</span>
<span class="n">dvz_graphics_vertex_binding</span><span class="p">(</span><span class="n">graphics</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">PointVertex</span><span class="p">));</span>

<span class="c1">// We now declare the vertex shader attributes, that should correspond to the different</span>
<span class="c1">// structure fields in the vertex structure.</span>

<span class="c1">// The first attribute is a vec3 in GLSL, and a vec3 in C too.</span>
<span class="n">dvz_graphics_vertex_attr</span><span class="p">(</span>
    <span class="n">graphics</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">VK_FORMAT_R32G32B32_SFLOAT</span><span class="p">,</span> <span class="n">offsetof</span><span class="p">(</span><span class="n">PointVertex</span><span class="p">,</span> <span class="n">pos</span><span class="p">));</span>

<span class="c1">// The second attribute is a float in GLSL, and a byte (uint8) in C. We use the special</span>
<span class="c1">// format VK_FORMAT_R8_USCALED to declare this.</span>
<span class="n">dvz_graphics_vertex_attr</span><span class="p">(</span>
    <span class="n">graphics</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">VK_FORMAT_R8_USCALED</span><span class="p">,</span> <span class="n">offsetof</span><span class="p">(</span><span class="n">PointVertex</span><span class="p">,</span> <span class="n">size</span><span class="p">));</span>

<span class="c1">// Now that we&#39;ve set up the graphics, we create it.</span>
<span class="n">dvz_graphics_create</span><span class="p">(</span><span class="n">graphics</span><span class="p">);</span>

<span class="c1">// We add our custom graphics to a custom visual.</span>
<span class="n">dvz_custom_graphics</span><span class="p">(</span><span class="n">visual</span><span class="p">,</span> <span class="n">graphics</span><span class="p">);</span>
</code></pre></div>
<p>As shown here, the creation of a custom graphics involves the following steps:</p>
<ul>
<li>Defining the shaders,</li>
<li>Defining the primitive type,</li>
<li>Declaring the vertex structure, the format of each field, and the casting between the GPU and GPU.</li>
</ul>
<p>There are further functions in the vklite API to customize the creation of the graphics pipeline. Refer to the Datoviz C API reference for more details.</p>
<h2 id="writing-the-custom-visual">Writing the custom visual<a class="headerlink" href="#writing-the-custom-visual" title="Permanent link">&para;</a></h2>
<p>Here is how to add a custom graphics to a custom visual:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// We create a blank visual, to which we&#39;ll add our custom visual.</span>
<span class="n">DvzVisual</span><span class="o">*</span> <span class="n">visual</span> <span class="o">=</span> <span class="n">dvz_blank_visual</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">DVZ_VISUAL_FLAGS_TRANSFORM_NONE</span><span class="p">);</span>

<span class="c1">// ... creating the custom graphics...</span>

<span class="c1">// We add our custom graphics to a custom visual.</span>
<span class="n">dvz_custom_graphics</span><span class="p">(</span><span class="n">visual</span><span class="p">,</span> <span class="n">graphics</span><span class="p">);</span>
</code></pre></div>
<p>At this point, the custom visual contains common sources (vertex, MVP, viewport) and props. One could then define more sources and props.</p>
<h2 id="writing-a-simple-test">Writing a simple test<a class="headerlink" href="#writing-a-simple-test" title="Permanent link">&para;</a></h2>
<p>Finally, here is how to use our custom visual with a custom graphics:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// ... creating the custom visual with the custom graphics...</span>

<span class="c1">// We add the custom visual to the panel.</span>
<span class="n">dvz_custom_visual</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span> <span class="n">visual</span><span class="p">);</span>

<span class="c1">// Now, we prepare the vertex data. We could have defined and used props, but we&#39;ll show</span>
<span class="c1">// another method instead. We create the vertex buffer directly, using the PointVertex</span>
<span class="c1">// structure we&#39;ve created.</span>
<span class="k">const</span> <span class="kt">uint32_t</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>                                  <span class="c1">// number of points</span>
<span class="n">PointVertex</span><span class="o">*</span> <span class="n">vertices</span> <span class="o">=</span> <span class="n">calloc</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">PointVertex</span><span class="p">));</span> <span class="c1">// vertex buffer</span>
<span class="kt">float</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">uint32_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="c1">// vertex position</span>
    <span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">.75</span> <span class="o">+</span> <span class="mf">1.25</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span><span class="p">;</span>
    <span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="mf">.75</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">*</span> <span class="n">t</span><span class="p">;</span>
    <span class="c1">// vertex size, in byte, between 0 and 255.</span>
    <span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">size</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Here is the crucial bit: we bind the GPU vertex buffer with our struct array.</span>
<span class="n">dvz_visual_data_source</span><span class="p">(</span><span class="n">visual</span><span class="p">,</span> <span class="n">DVZ_SOURCE_TYPE_VERTEX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">vertices</span><span class="p">);</span>
<span class="n">FREE</span><span class="p">(</span><span class="n">vertices</span><span class="p">);</span>
</code></pre></div>
<p>Here are a few comments:</p>
<ul>
<li>Instead of using visual props, we have defined the vertex structure directly. The whole point of the visual props is to avoid doing this, which may not be particularly easy with complex vertex shaders with many attributes. Also, setting the vertex buffer directly requires to understand how the graphics is implemented on the GPU. If some form of triangulation is required, it is up to the user to do it. In this particular example, there is no triangulation as we have a one-to-one correspondance between the squares and the vertices.</li>
<li>Note that the data buffers passed to the <code>dvz_visual_data*()</code> functions make a copy of the data, so we're fine freeing it.</li>
</ul>
<h2 id="other-topics">Other topics<a class="headerlink" href="#other-topics" title="Permanent link">&para;</a></h2>
<p>We didn't yet cover these other aspects:</p>
<ul>
<li>Other resources (textures, other uniforms),</li>
<li>Other shaders (geometry shader, tesselation shader),</li>
<li>Indexed rendering,</li>
<li>Indirect rendering,</li>
<li>Fixed functions,</li>
<li>Depth testing,</li>
<li>Dynamic states,</li>
<li>Specialization constants,</li>
<li>Push constants,</li>
<li>Custom command buffers,</li>
<li>Interaction with compute shaders,</li>
<li>And many other topics...</li>
</ul>
<h2 id="checklist-for-datoviz-contributors">Checklist for Datoviz contributors<a class="headerlink" href="#checklist-for-datoviz-contributors" title="Permanent link">&para;</a></h2>
<p>This is a handy checklist for developers when adding new graphics to the library (via a pull request).</p>
<ul>
<li><code>graphics.h</code>:<ul>
<li>Add the typedef of the vertex, item, params structures</li>
<li>Add new section and structs for vertex, item, params structures<ul>
<li>Make sure all fields in the params struct have a byte size that is not 3 or divisible by 3</li>
</ul>
</li>
<li>Put comments after each struct field (used by automatic documentation generator)</li>
</ul>
</li>
<li><code>vklite.h</code>:<ul>
<li>Make sure the <code>DvzGraphicsType</code> enum exists, or create a new one</li>
</ul>
</li>
<li>Shaders: <code>graphics_xxx.vert|frag</code>:<ul>
<li>Don't forget to import <code>common.glsl</code> in all shaders</li>
<li>The first user binding should be params, should match exactly the struct</li>
<li>The next bindings should be numbered with USER_BINDING+1 etc</li>
<li>The body of the main fragment shader function should always begin with <code>CLIP</code></li>
</ul>
</li>
<li><code>graphics.c</code>:<ul>
<li>Add new section, with <code>_graphics_xxx()</code> and <code>_graphics_xxx_callback()</code> if there is a non-default graphics callback function</li>
<li>Write the main graphics function<ul>
<li>Specify the shaders</li>
<li>Specify the primitive type</li>
<li>Specify the vertex attributes, should match the vertex shader</li>
<li>Add the common slots</li>
<li>Add slots for params/textures</li>
<li>Specify the graphics callback function</li>
</ul>
</li>
<li>(optional) Write the graphics callback function<ul>
<li>This function is called when a new item is added to the graphics. What an "item" is is up to the create of a graphics. It's typically the smallest bit of data that has a meaning in the context of the graphics. The graphics callback is mostly used for pre-upload CPU-side "triangulation" of the data, so that the visuals that reuse this graphics don't have to know the details of the triangulation.</li>
</ul>
</li>
<li>Add the switch case in <code>dvz_graphics_builtin()</code></li>
</ul>
</li>
<li><code>test_graphics.h</code>:<ul>
<li>Add the new graphics test declaration</li>
</ul>
</li>
<li><code>test_graphics.c</code>:<ul>
<li>Write the body of the test function</li>
<li>Set to save the screenshot with the graphics name</li>
</ul>
</li>
<li><code>main.c</code>:<ul>
<li>Add the new test to the list of test functions</li>
</ul>
</li>
<li>Test the graphics without interactivity and save the graphics screenshot</li>
<li>Add graphics section in <code>docs/reference/graphics.md</code></li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../visual/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                How to write a custom visual
              </div>
            </div>
          </a>
        
        
          <a href="../standalone_canvas/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                How to use the canvas C API
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.53cc9318.min.js"></script>
      <script src="../../assets/javascripts/bundle.e9c9f54f.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ['navigation.tabs', 'navigation.tabs.sticky', 'navigation.expand', 'toc.integrate'],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>