
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="High-performance interactive scientific data visualization library">
      
      
      
        <meta name="author" content="Cyrille Rossant">
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.7">
    
    
      
        <title>How to write a custom visual - Datoviz Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.39b8e14a.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-to-write-a-custom-visual" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="Datoviz Documentation" class="md-header-nav__button md-logo" aria-label="Datoviz Documentation">
      
  <img src="../../images/logow.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Datoviz Documentation
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              How to write a custom visual
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/datoviz/datoviz/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../tutorials/" class="md-tabs__link">
        Getting started
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../examples/" class="md-tabs__link">
        Examples
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../" class="md-tabs__link md-tabs__link--active">
        How to guides
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../reference/" class="md-tabs__link">
        Reference
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../api/" class="md-tabs__link">
        C API reference
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../discussions/" class="md-tabs__link">
        Discussions
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Datoviz Documentation" class="md-nav__button md-logo" aria-label="Datoviz Documentation">
      
  <img src="../../images/logow.png" alt="logo">

    </a>
    Datoviz Documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/datoviz/datoviz/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" data-md-state="indeterminate" type="checkbox" id="nav-2" checked>
      
      <label class="md-nav__link" for="nav-2">
        Getting started
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Getting started" data-md-level="1">
        <label class="md-nav__title" for="nav-2">
          <span class="md-nav__icon md-icon"></span>
          Getting started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/" class="md-nav__link">
        Index
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/install/" class="md-nav__link">
        Installation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/quickstart/" class="md-nav__link">
        Quickstart
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" data-md-state="indeterminate" type="checkbox" id="nav-3" checked>
      
      <label class="md-nav__link" for="nav-3">
        Examples
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="nav-3">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/quickstart/" class="md-nav__link">
        Quickstart tutorial
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/image/" class="md-nav__link">
        Image blending
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/france/" class="md-nav__link">
        France departements
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/signals/" class="md-nav__link">
        Digital signals
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/brain/" class="md-nav__link">
        3D brain mesh
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/twopanels/" class="md-nav__link">
        Two panels
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/colormap/" class="md-nav__link">
        Custom colormap
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/eventloop/" class="md-nav__link">
        Async event loop
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
      
      <label class="md-nav__link" for="nav-4">
        How to guides
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="How to guides" data-md-level="1">
        <label class="md-nav__title" for="nav-4">
          <span class="md-nav__icon md-icon"></span>
          How to guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Index
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-2" data-md-state="indeterminate" type="checkbox" id="nav-4-2" checked>
      
      <label class="md-nav__link" for="nav-4-2">
        Standalone C apps
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Standalone C apps" data-md-level="2">
        <label class="md-nav__title" for="nav-4-2">
          <span class="md-nav__icon md-icon"></span>
          Standalone C apps
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../standalone_scene/" class="md-nav__link">
        How to use the scene C API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../standalone_canvas/" class="md-nav__link">
        How to use the canvas C API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../standalone_vklite/" class="md-nav__link">
        How to use the vklite C API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../standalone_imgui/" class="md-nav__link">
        How to use Dear ImGui directly
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3" checked>
      
      <label class="md-nav__link" for="nav-4-3">
        Custom visuals and graphics
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Custom visuals and graphics" data-md-level="2">
        <label class="md-nav__title" for="nav-4-3">
          <span class="md-nav__icon md-icon"></span>
          Custom visuals and graphics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          How to write a custom visual
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        How to write a custom visual
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-a-visual" class="md-nav__link">
    What is a visual?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visual-properties-or-props" class="md-nav__link">
    Visual properties, or "props"
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#batch-rendering" class="md-nav__link">
    Batch rendering
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distinction-between-graphics-and-visuals" class="md-nav__link">
    Distinction between graphics and visuals
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#making-a-custom-visual-based-on-existing-graphics" class="md-nav__link">
    Making a custom visual based on existing graphics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vertex-shader-attributes-vertex-buffer-vertex-structure" class="md-nav__link">
    Vertex shader attributes, vertex buffer, vertex structure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visual-baking-function" class="md-nav__link">
    Visual baking function
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#putting-everything-together" class="md-nav__link">
    Putting everything together
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-topics" class="md-nav__link">
    Other topics
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../graphics/" class="md-nav__link">
        How to write a custom graphics
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" data-md-state="indeterminate" type="checkbox" id="nav-5" checked>
      
      <label class="md-nav__link" for="nav-5">
        Reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="nav-5">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/" class="md-nav__link">
        Index
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/visuals/" class="md-nav__link">
        Library of visuals
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/graphics/" class="md-nav__link">
        Library of graphics
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/colormaps/" class="md-nav__link">
        Library of colormaps
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/controllers/" class="md-nav__link">
        Library of controllers
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" data-md-state="indeterminate" type="checkbox" id="nav-6" checked>
      
      <label class="md-nav__link" for="nav-6">
        C API reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="C API reference" data-md-level="1">
        <label class="md-nav__title" for="nav-6">
          <span class="md-nav__icon md-icon"></span>
          C API reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../api/" class="md-nav__link">
        Index
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../api/scene/" class="md-nav__link">
        Scene API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../api/visual/" class="md-nav__link">
        Visual API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../api/controller/" class="md-nav__link">
        Controller API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../api/gui/" class="md-nav__link">
        GUI API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../api/canvas/" class="md-nav__link">
        Canvas API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../api/gpu/" class="md-nav__link">
        GPU API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../api/vklite/" class="md-nav__link">
        vklite API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../api/misc/" class="md-nav__link">
        Misc API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../api/enums/" class="md-nav__link">
        Enumerations
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" data-md-state="indeterminate" type="checkbox" id="nav-7" checked>
      
      <label class="md-nav__link" for="nav-7">
        Discussions
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Discussions" data-md-level="1">
        <label class="md-nav__title" for="nav-7">
          <span class="md-nav__icon md-icon"></span>
          Discussions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../discussions/" class="md-nav__link">
        Index
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7-2" data-md-state="indeterminate" type="checkbox" id="nav-7-2" checked>
      
      <label class="md-nav__link" for="nav-7-2">
        For users
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="For users" data-md-level="2">
        <label class="md-nav__title" for="nav-7-2">
          <span class="md-nav__icon md-icon"></span>
          For users
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../discussions/vulkan/" class="md-nav__link">
        Vulkan crash course
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../discussions/roadmap/" class="md-nav__link">
        Roadmap
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../discussions/practices/" class="md-nav__link">
        Best practices
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../discussions/faq/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7-3" data-md-state="indeterminate" type="checkbox" id="nav-7-3" checked>
      
      <label class="md-nav__link" for="nav-7-3">
        For developers
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="For developers" data-md-level="2">
        <label class="md-nav__title" for="nav-7-3">
          <span class="md-nav__icon md-icon"></span>
          For developers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../discussions/architecture/" class="md-nav__link">
        Library architecture
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../discussions/developer/" class="md-nav__link">
        Developer notes
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../discussions/checklists/" class="md-nav__link">
        Developer checklists
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/datoviz/datoviz/edit/master/docs/howto/visual.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="how-to-write-a-custom-visual">How to write a custom visual<a class="headerlink" href="#how-to-write-a-custom-visual" title="Permanent link">&para;</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You need to go through the <a href="../../discussions/vulkan/"><strong>Vulkan crash course</strong></a> before following this guide.</p>
</div>
<p>In this section, we'll show how to create a custom visual based on an existing graphics pipeline, so <strong>without writing custom GLSL shaders</strong>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only the C API supports custom visuals at the moment. Python bindings for custom visuals will come in an upcoming version.</p>
</div>
<p>The full source code for this example can be found in <code>examples/custom_visual.c</code>.</p>
<p>We'll make a <strong>square visual</strong> that makes it easy to add uniformly-colored squares to the scene.</p>
<p><img alt="" src="../../images/screenshots/custom_visual.png" /></p>
<h2 id="what-is-a-visual">What is a visual?<a class="headerlink" href="#what-is-a-visual" title="Permanent link">&para;</a></h2>
<p>The <strong>visual</strong> is the most important abstraction in Datoviz. It abstracts away the internal details related to GPU rendering and proposes a user-friendly interface to set up visual elements.</p>
<p>Generally speaking, adding a new visual to a panel involves the following steps:</p>
<ol>
<li>choosing one of the existing visuals on the visual reference page,</li>
<li>preparing the data to match the format expected by the visual properties,</li>
<li>setting the visual properties with the data.</li>
</ol>
<h2 id="visual-properties-or-props">Visual properties, or "props"<a class="headerlink" href="#visual-properties-or-props" title="Permanent link">&para;</a></h2>
<p>Each predefined visual comes with a set of predefined visual properties, also called <strong>props</strong>. For example, the <code>marker</code> visual has props for: point position, color, marker size, marker type, angle, and so on.</p>
<p>The <a href="../../reference/visuals/">visual reference page</a> presents the list of all predefined visuals along with their sets of props. You'll probably refer a lot to this page since it contains the most important information you'll need for your visualizations.</p>
<p>Each prop is defined by:</p>
<ul>
<li>a name,</li>
<li>a data type (for example <code>float32</code>, <code>uint8</code>),</li>
<li>a description of how the prop is used for rendering.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Python API takes care of converting each prop to the correct data type using NumPy <code>ndarray.astype()</code>. Most props accepting floating-point numbers require single-precision format since this is the optimal format for GPUs. The notable exception is the POS prop (position), which requires double-precision data. Datoviz provides an internal CPU-based data transformation system that requires double precision (single-precision would not be acceptable for scientific data handling). Also, visuals that implement triangulation require double precision. Datoviz converts the transformed position to single-precision at the last moment before uploading it to the GPU.</p>
</div>
<h2 id="batch-rendering">Batch rendering<a class="headerlink" href="#batch-rendering" title="Permanent link">&para;</a></h2>
<p>Another crucial notion related to visuals is <strong>batch rendering</strong>. For performance reasons, it is recommended <strong>to use as few visuals as possible in a given scene</strong>. For example:</p>
<ul>
<li>to display a scatter plot with 100 points, use a single <code>marker</code> visual with 100 points, instead of <del>100 visuals with one point</del>,</li>
<li>to display 100 polygons, use a single <code>polygon</code> visual with 100 items (each containing an arbitrary number of points), instead of <del>100 visuals</del>,</li>
<li>similarly with paths, images, meshes, text, and so on.</li>
</ul>
<p>This allows the GPU to render all of these different objects of the same type in a single draw command (with the same GPU transformation matrices).</p>
<p>To define multiple objects with various sizes in a given visual (for example, displaying multiple paths with the same visual), one typically concatenates all points and properties in big arrays (total size is the sum of all object sizes), and use the special prop <code>length</code> to define the length of each object (vector with as many elements as there are different objects).</p>
<h2 id="distinction-between-graphics-and-visuals">Distinction between graphics and visuals<a class="headerlink" href="#distinction-between-graphics-and-visuals" title="Permanent link">&para;</a></h2>
<p>Datoviz makes the distinction between a <strong>graphics</strong> (graphics pipeline) and a <strong>visual</strong>:</p>
<ul>
<li>a <strong>graphics</strong> is a GPU-level object. It is defined by a vertex shader, a fragment shader, a primitive type (point, line, triangle), and other details.</li>
<li>a <strong>visual</strong> is a user-level object. It encapsulates a particular type of visual element and abstracts away the GPU implementation details. A visual is defined by one or several graphics pipelines, optional compute pipelines, and a set of <strong>visual properties</strong> that allow the user to specify the visual's data.</li>
</ul>
<p>Importantly, the user doesn't need to know the internal implementation details of a visual to use it. It is normally sufficient to know the props specification.</p>
<h2 id="making-a-custom-visual-based-on-existing-graphics">Making a custom visual based on existing graphics<a class="headerlink" href="#making-a-custom-visual-based-on-existing-graphics" title="Permanent link">&para;</a></h2>
<p>In this section, we'll show how to <strong>create a custom visual by reusing an existing graphics</strong> (without writing custom shaders). The main use-case for this scenario is making a visual with a <strong>custom CPU data transformation pipeline</strong>.</p>
<p>An example is polygon triangulation: since the GPU can only render triangles, one needs to triangulate an arbitrary shape before rendering it. The triangulation is implemented at the level of the visual, so that the user can pass the polygon points without having to triangulate it manually. The visual makes the triangulation internally, and generates the triangles required by the underlying graphics pipeline.</p>
<p>In the simple example below, we'll implement a simple <strong>square visual</strong> with a trivial triangulation (two triangles per square). The custom square visual will provide the following props:</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Index</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>pos</code></td>
<td>0</td>
<td><code>dvec3</code></td>
<td>square center position</td>
</tr>
<tr>
<td><code>color</code></td>
<td>0</td>
<td><code>cvec4</code></td>
<td>square color</td>
</tr>
<tr>
<td><code>length</code></td>
<td>0</td>
<td><code>float</code></td>
<td>edge length</td>
</tr>
</tbody>
</table>
<p>The underlying graphics will be the <code>triangle</code> graphics, where three successive vertices define a single independent triangle. Each square will be triangulated into two triangles, or six vertices. This square visual will be easier to use than the triangle one, since the user won't have to deal with triangulation manually.</p>
<p>Here is the code to define the three visual props:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// pos prop, dvec3 data type</span>
<span class="n">dvz_visual_prop</span><span class="p">(</span><span class="n">visual</span><span class="p">,</span> <span class="n">DVZ_PROP_POS</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">DVZ_DTYPE_DVEC3</span><span class="p">,</span> <span class="n">DVZ_SOURCE_TYPE_VERTEX</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="c1">// color prop, cvec4 data type</span>
<span class="n">dvz_visual_prop</span><span class="p">(</span><span class="n">visual</span><span class="p">,</span> <span class="n">DVZ_PROP_COLOR</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">DVZ_DTYPE_CVEC4</span><span class="p">,</span> <span class="n">DVZ_SOURCE_TYPE_VERTEX</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="c1">// length prop, float data type</span>
<span class="n">dvz_visual_prop</span><span class="p">(</span><span class="n">visual</span><span class="p">,</span> <span class="n">DVZ_PROP_LENGTH</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">DVZ_DTYPE_FLOAT</span><span class="p">,</span> <span class="n">DVZ_SOURCE_TYPE_VERTEX</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</code></pre></div>
<h2 id="vertex-shader-attributes-vertex-buffer-vertex-structure">Vertex shader attributes, vertex buffer, vertex structure<a class="headerlink" href="#vertex-shader-attributes-vertex-buffer-vertex-structure" title="Permanent link">&para;</a></h2>
<p>To each graphics is associated a particular vertex shader. A vertex shader defines a list of <strong>attributes</strong>, which correspond to the different vertex inputs. For example, the <code>triangle</code> graphics we will use in this example has two attributes in its vertex shader:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// This GLSL code is at the beginning of the triangle graphics vertex shader.</span>
<span class="c1">// Two attributes:</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mo">0</span><span class="p">)</span> <span class="k">in</span> <span class="kt">vec3</span> <span class="n">pos</span><span class="p">;</span>   <span class="c1">// vertex position</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">in</span> <span class="kt">vec4</span> <span class="n">color</span><span class="p">;</span> <span class="c1">// vertex color</span>
</code></pre></div>
<p>In Datoviz, the input data feeding these vertex shader attributes is stored in a GPU buffer called the <strong>vertex buffer</strong>. The GPU buffer contains a contiguous array of structure elements that match exactly these attributes. Here, the vertex structure of the <code>triangle</code> graphics, and of the other basic graphics, is the standard <code>DvzVertex</code> structure:</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span> <span class="n">DvzVertex</span>
<span class="p">{</span>
    <span class="n">vec3</span> <span class="n">pos</span><span class="p">;</span>    <span class="c1">// three single-precision floating-point numbers for x, y, z position</span>
    <span class="n">cvec4</span> <span class="n">color</span><span class="p">;</span> <span class="c1">// four uint8 bytes for the r, g, b, a color components</span>
<span class="p">}</span>
</code></pre></div>
<p>The vertex shader executes in parallel over all structure elements stored in the vertex buffer.</p>
<p>We'll see in the custom graphics page more details about how we link this C structure to the GLSL attributes.</p>
<p>The main role of the <strong>visual</strong> is to <strong>copy the user-specified props data into the vertex buffer</strong>. This is sometimes straightforward, like in the <code>marker</code> visual, where each vertex corresponds to one marker, but it is often less trivial. In the example covered in this page, where we need to transform squares into triangles, our custom visual will need to <strong>create six vertices in the vertex buffer for every square passed by the user</strong>. This is implemented in the <strong>visual baking function</strong>.</p>
<h2 id="visual-baking-function">Visual baking function<a class="headerlink" href="#visual-baking-function" title="Permanent link">&para;</a></h2>
<p>Once the props are defined, the most important step when creating a custom visual is to implement the <strong>baking function</strong>.</p>
<p><strong>The baking function takes the props data as input, and fills in the vertex buffer</strong>, as well as, possibly, other GPU data sources (uniforms, storage buffers, textures).</p>
<p>Here, the square baking function must recover the <code>pos</code> and <code>length</code> props in order to compute the four corner position of each square, and make the triangulation with two triangles per square.</p>
<p>The props and the vertex buffer (and other sources) come with <code>DvzArray</code> instances, which are thin wrappers around 1D arrays of homogeneous data types. They support few features: no multidimensional arrays, no vectorized operations.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// The following code snippet contains the body of the baking function.</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">_bake_callback</span><span class="p">(</span><span class="n">DvzVisual</span><span class="o">*</span> <span class="n">visual</span><span class="p">,</span> <span class="n">DvzVisualDataEvent</span> <span class="n">ev</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ASSERT</span><span class="p">(</span><span class="n">visual</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="c1">// First, we obtain the array instances holding the prop data as specified by the user.</span>
    <span class="n">DvzArray</span><span class="o">*</span> <span class="n">arr_pos</span> <span class="o">=</span> <span class="n">dvz_prop_array</span><span class="p">(</span><span class="n">visual</span><span class="p">,</span> <span class="n">DVZ_PROP_POS</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">DvzArray</span><span class="o">*</span> <span class="n">arr_color</span> <span class="o">=</span> <span class="n">dvz_prop_array</span><span class="p">(</span><span class="n">visual</span><span class="p">,</span> <span class="n">DVZ_PROP_COLOR</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">DvzArray</span><span class="o">*</span> <span class="n">arr_length</span> <span class="o">=</span> <span class="n">dvz_prop_array</span><span class="p">(</span><span class="n">visual</span><span class="p">,</span> <span class="n">DVZ_PROP_LENGTH</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

    <span class="c1">// We also get the array of the vertex buffer, which we&#39;ll need to fill with the triangulation.</span>
    <span class="n">DvzArray</span><span class="o">*</span> <span class="n">arr_vertex</span> <span class="o">=</span> <span class="n">dvz_source_array</span><span class="p">(</span><span class="n">visual</span><span class="p">,</span> <span class="n">DVZ_SOURCE_TYPE_VERTEX</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

    <span class="c1">// The number of rows in the 1D position array (set by the user) is the number of squares</span>
    <span class="c1">// requested by the user.</span>
    <span class="kt">uint32_t</span> <span class="n">square_count</span> <span class="o">=</span> <span class="n">arr_pos</span><span class="o">-&gt;</span><span class="n">item_count</span><span class="p">;</span>

    <span class="c1">// We resize the vertex buffer array so that it holds six vertices per square (two triangles).</span>
    <span class="n">dvz_array_resize</span><span class="p">(</span><span class="n">arr_vertex</span><span class="p">,</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">square_count</span><span class="p">);</span>

    <span class="c1">// Pointers to the input data.</span>
    <span class="n">dvec3</span><span class="o">*</span> <span class="n">pos</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">cvec4</span><span class="o">*</span> <span class="n">color</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="kt">float</span><span class="o">*</span> <span class="n">length</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="c1">// Pointer to the output vertex.</span>
    <span class="n">DvzVertex</span><span class="o">*</span> <span class="n">vertex</span> <span class="o">=</span> <span class="p">(</span><span class="n">DvzVertex</span><span class="o">*</span><span class="p">)</span><span class="n">arr_vertex</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>

    <span class="c1">// Here, we triangulate each square by computing the position of each square corner.</span>
    <span class="kt">float</span> <span class="n">hl</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint32_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">square_count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// We get a pointer to the current item in each prop array.</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">dvz_array_item</span><span class="p">(</span><span class="n">arr_pos</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">dvz_array_item</span><span class="p">(</span><span class="n">arr_color</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="n">length</span> <span class="o">=</span> <span class="n">dvz_array_item</span><span class="p">(</span><span class="n">arr_length</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>

        <span class="c1">// This is the half of the square size.</span>
        <span class="n">hl</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">length</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

        <span class="c1">// First triangle:</span>

        <span class="c1">// Bottom-left corner.</span>
        <span class="n">vertex</span><span class="p">[</span><span class="mi">6</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">0</span><span class="p">].</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">hl</span><span class="p">;</span>
        <span class="n">vertex</span><span class="p">[</span><span class="mi">6</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">0</span><span class="p">].</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">hl</span><span class="p">;</span>

        <span class="c1">// Bottom-right corner.</span>
        <span class="n">vertex</span><span class="p">[</span><span class="mi">6</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">hl</span><span class="p">;</span>
        <span class="n">vertex</span><span class="p">[</span><span class="mi">6</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">hl</span><span class="p">;</span>

        <span class="c1">// Top-right corner.</span>
        <span class="n">vertex</span><span class="p">[</span><span class="mi">6</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">].</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">hl</span><span class="p">;</span>
        <span class="n">vertex</span><span class="p">[</span><span class="mi">6</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">].</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">hl</span><span class="p">;</span>

        <span class="c1">// Second triangle:</span>

        <span class="c1">// Top-right corner again.</span>
        <span class="n">vertex</span><span class="p">[</span><span class="mi">6</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">].</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">hl</span><span class="p">;</span>
        <span class="n">vertex</span><span class="p">[</span><span class="mi">6</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">].</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">hl</span><span class="p">;</span>

        <span class="c1">// Top-left corner.</span>
        <span class="n">vertex</span><span class="p">[</span><span class="mi">6</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">].</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">hl</span><span class="p">;</span>
        <span class="n">vertex</span><span class="p">[</span><span class="mi">6</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">].</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">hl</span><span class="p">;</span>

        <span class="c1">// Bottom-left corner (again).</span>
        <span class="n">vertex</span><span class="p">[</span><span class="mi">6</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">5</span><span class="p">].</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">hl</span><span class="p">;</span>
        <span class="n">vertex</span><span class="p">[</span><span class="mi">6</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">5</span><span class="p">].</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">hl</span><span class="p">;</span>

        <span class="c1">// We copy the square color to each of the six vertices making the current square.</span>
        <span class="c1">// This is a choice made in this example, and it is up to the custom visual creator</span>
        <span class="c1">// to define how the user data, passed via props, will be used to fill in the vertices.</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint32_t</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
            <span class="n">memcpy</span><span class="p">(</span><span class="n">vertex</span><span class="p">[</span><span class="mi">6</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">].</span><span class="n">color</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">cvec4</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="putting-everything-together">Putting everything together<a class="headerlink" href="#putting-everything-together" title="Permanent link">&para;</a></h2>
<p>Here is the code to create the custom visual.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// We create a blank visual in the scene.</span>
<span class="c1">// For demo purposes, we disable the automatic position normalization.</span>
<span class="n">DvzVisual</span><span class="o">*</span> <span class="n">visual</span> <span class="o">=</span> <span class="n">dvz_blank_visual</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">DVZ_VISUAL_FLAGS_TRANSFORM_NONE</span><span class="p">);</span>

<span class="c1">// We add the existing graphics triangle graphics pipeline.</span>
<span class="n">dvz_visual_graphics</span><span class="p">(</span><span class="n">visual</span><span class="p">,</span> <span class="n">dvz_graphics_builtin</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">DVZ_GRAPHICS_TRIANGLE</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>

<span class="c1">// We add the vertex buffer source, and we must specify the same vertex struct type</span>
<span class="c1">// as the one used by the graphics pipeline (standard vertex structure, with pos and color).</span>
<span class="n">dvz_visual_source</span><span class="p">(</span>
    <span class="n">visual</span><span class="p">,</span> <span class="n">DVZ_SOURCE_TYPE_VERTEX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">DVZ_PIPELINE_GRAPHICS</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">DvzVertex</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>

<span class="c1">// We specify the visual props.</span>
<span class="n">dvz_visual_prop</span><span class="p">(</span><span class="n">visual</span><span class="p">,</span> <span class="n">DVZ_PROP_POS</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">DVZ_DTYPE_DVEC3</span><span class="p">,</span> <span class="n">DVZ_SOURCE_TYPE_VERTEX</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">dvz_visual_prop</span><span class="p">(</span><span class="n">visual</span><span class="p">,</span> <span class="n">DVZ_PROP_COLOR</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">DVZ_DTYPE_CVEC4</span><span class="p">,</span> <span class="n">DVZ_SOURCE_TYPE_VERTEX</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">dvz_visual_prop</span><span class="p">(</span><span class="n">visual</span><span class="p">,</span> <span class="n">DVZ_PROP_LENGTH</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">DVZ_DTYPE_FLOAT</span><span class="p">,</span> <span class="n">DVZ_SOURCE_TYPE_VERTEX</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="c1">// We declare our custom baking function.</span>
<span class="n">dvz_visual_callback_bake</span><span class="p">(</span><span class="n">visual</span><span class="p">,</span> <span class="n">_bake_callback</span><span class="p">);</span>

<span class="c1">// Finally, once the custom visual has been created, we can add it to the panel.</span>
<span class="n">dvz_custom_visual</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span> <span class="n">visual</span><span class="p">);</span>
</code></pre></div>
<p>Once the custom visual has been created and added to the scene, the last step consists of setting some data, as usual:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// We define three squares.</span>
<span class="n">dvz_visual_data</span><span class="p">(</span>
    <span class="n">visual</span><span class="p">,</span> <span class="n">DVZ_PROP_POS</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="n">dvec3</span><span class="p">[]){{</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="o">+</span><span class="mf">.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">}});</span>

<span class="c1">// We use a different color for each square.</span>
<span class="n">dvz_visual_data</span><span class="p">(</span>
    <span class="n">visual</span><span class="p">,</span> <span class="n">DVZ_PROP_COLOR</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
    <span class="p">(</span><span class="n">cvec4</span><span class="p">[]){{</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">}});</span>

<span class="c1">// NOTE: we use the same length for all squares.</span>
<span class="n">dvz_visual_data</span><span class="p">(</span><span class="n">visual</span><span class="p">,</span> <span class="n">DVZ_PROP_LENGTH</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="kt">float</span><span class="p">[]){</span><span class="mf">.25</span><span class="p">});</span>
</code></pre></div>
<p>Note that we used a single value for the last prop (edge length). Datoviz uses the convention that a prop may have less values than objects, in which case <strong>the last value is repeated over</strong>. In particular, defining a prop with a single element means using the same value for all items in the visual. This is a sort of "broadcasting" rule (following NumPy's terminology).</p>
<h2 id="other-topics">Other topics<a class="headerlink" href="#other-topics" title="Permanent link">&para;</a></h2>
<p>We didn't yet cover these other aspects:</p>
<ul>
<li>Position data transformation,</li>
<li>Visual parameters stored in the uniform buffer,</li>
<li>Visual flags.</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../standalone_imgui/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                How to use Dear ImGui directly
              </div>
            </div>
          </a>
        
        
          <a href="../graphics/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                How to write a custom graphics
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.53cc9318.min.js"></script>
      <script src="../../assets/javascripts/bundle.e9c9f54f.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ['navigation.tabs', 'navigation.tabs.sticky', 'navigation.expand', 'toc.integrate'],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>